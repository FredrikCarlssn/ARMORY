{"version":3,"file":"static/js/7415.756e218d.chunk.js","mappings":"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","sources":["../node_modules/@thirdweb-dev/sdk/dist/QueryParams-232cc4d3.browser.esm.js","../node_modules/@thirdweb-dev/sdk/dist/cleanCurrencyAddress-8dc58c8d.browser.esm.js","../node_modules/@thirdweb-dev/sdk/dist/contract-interceptor-d7b164a7.browser.esm.js","../node_modules/@thirdweb-dev/sdk/dist/contract-platform-fee-b2e53cfb.browser.esm.js","../node_modules/@thirdweb-dev/sdk/dist/contract-roles-a1bd9cb8.browser.esm.js","../node_modules/@thirdweb-dev/sdk/dist/ListingType-cba090cb.browser.esm.js","../node_modules/@thirdweb-dev/sdk/dist/marketplace-0a2d6f87.browser.esm.js","../node_modules/@thirdweb-dev/sdk/dist/marketplace-6ed5a4ea.browser.esm.js","../node_modules/@thirdweb-dev/sdk/dist/setErc20Allowance-13dbcc30.browser.esm.js"],"sourcesContent":["import { a as CommonNFTOutput, C as CommonNFTInput } from './setErc20Allowance-13dbcc30.browser.esm.js';\nimport { utils, BigNumber, Contract } from 'ethers';\nimport 'zod';\n\n/**\n * @internal\n */\n\n/**\n * @internal\n */\nconst InterfaceId_IERC721 = /* @__PURE__ */(() => utils.arrayify(\"0x80ac58cd\"))();\n\n/**\n * @internal\n */\nconst InterfaceId_IERC1155 = /* @__PURE__ */(() => utils.arrayify(\"0xd9b67a26\"))();\n\nconst FALLBACK_METADATA = {\n  name: \"Failed to load NFT metadata\"\n};\n\n/**\n * fetches the token metadata\n * @param tokenId - the id (to get it back in the output)\n * @param tokenUri - the uri to fetch\n * @param storage - which storage to fetch from\n *\n * @internal\n */\nasync function fetchTokenMetadata(tokenId, tokenUri, storage) {\n  // check for base64 encoded JSON\n  if (tokenUri.startsWith(\"data:application/json;base64\") && typeof Buffer !== \"undefined\") {\n    const base64 = tokenUri.split(\",\")[1];\n    const jsonMetadata = JSON.parse(Buffer.from(base64, \"base64\").toString(\"utf-8\"));\n    return CommonNFTOutput.parse({\n      ...jsonMetadata,\n      id: BigNumber.from(tokenId).toString(),\n      uri: tokenUri\n    });\n  }\n  // handle dynamic id URIs (2 possible formats)\n  const parsedUri = tokenUri.replace(\"{id}\", utils.hexZeroPad(BigNumber.from(tokenId).toHexString(), 32).slice(2));\n  let jsonMetadata;\n  try {\n    jsonMetadata = await storage.downloadJSON(parsedUri);\n  } catch (err) {\n    const unparsedTokenIdUri = tokenUri.replace(\"{id}\", BigNumber.from(tokenId).toString());\n    try {\n      jsonMetadata = await storage.downloadJSON(unparsedTokenIdUri);\n    } catch (e) {\n      console.warn(`failed to get token metadata: ${JSON.stringify({\n        tokenId: tokenId.toString(),\n        tokenUri\n      })} -- falling back to default metadata`);\n      jsonMetadata = FALLBACK_METADATA;\n    }\n  }\n  return CommonNFTOutput.parse({\n    ...jsonMetadata,\n    id: BigNumber.from(tokenId).toString(),\n    uri: tokenUri\n  });\n}\n\n// Used for marketplace to fetch NFT metadata from contract address + tokenId\n/**\n * @internal\n * @param contractAddress - the contract address\n * @param provider - the provider to use\n * @param tokenId - the token id\n * @param storage - the storage to use\n */\nasync function fetchTokenMetadataForContract(contractAddress, provider, tokenId, storage) {\n  let uri;\n  const ERC165MetadataAbi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC165.json')).default;\n  const erc165 = new Contract(contractAddress, ERC165MetadataAbi, provider);\n  const [isERC721, isERC1155] = await Promise.all([erc165.supportsInterface(InterfaceId_IERC721), erc165.supportsInterface(InterfaceId_IERC1155)]);\n  if (isERC721) {\n    const ERC721MetadataAbi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC721Metadata.json')).default;\n    const erc721 = new Contract(contractAddress, ERC721MetadataAbi, provider);\n    uri = await erc721.tokenURI(tokenId);\n  } else if (isERC1155) {\n    const ERC1155MetadataAbi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC1155Metadata.json')).default;\n    const erc1155 = new Contract(contractAddress, ERC1155MetadataAbi, provider);\n    uri = await erc1155.uri(tokenId);\n  } else {\n    throw Error(\"Contract must implement ERC 1155 or ERC 721.\");\n  }\n  if (!uri) {\n    // no uri found, return fallback metadata\n    return CommonNFTOutput.parse({\n      ...FALLBACK_METADATA,\n      id: BigNumber.from(tokenId).toString(),\n      uri: \"\"\n    });\n  }\n  return fetchTokenMetadata(tokenId, uri, storage);\n}\n\n/**\n * @internal\n * @param metadata - the metadata to upload\n * @param storage - the storage to use\n */\nasync function uploadOrExtractURI(metadata, storage) {\n  if (typeof metadata === \"string\") {\n    return metadata;\n  } else {\n    return await storage.upload(CommonNFTInput.parse(metadata));\n  }\n}\n\n/**\n * @internal\n * @param metadatas - the metadata to upload\n * @param storage - the storage to use\n * @param startNumber - the number to start the file names at\n * @param contractAddress - the contract address\n * @param signerAddress - the signer address\n * @param options - options\n */\nasync function uploadOrExtractURIs(metadatas, storage, startNumber, options) {\n  if (isUriList(metadatas)) {\n    return metadatas;\n  } else if (isMetadataList(metadatas)) {\n    const uris = await storage.uploadBatch(metadatas.map(m => CommonNFTInput.parse(m)), {\n      rewriteFileNames: {\n        fileStartNumber: startNumber || 0\n      },\n      onProgress: options?.onProgress\n    });\n    return uris;\n  } else {\n    throw new Error(\"NFT metadatas must all be of the same type (all URI or all NFTMetadataInput)\");\n  }\n}\nfunction getBaseUriFromBatch(uris) {\n  const baseUri = uris[0].substring(0, uris[0].lastIndexOf(\"/\"));\n  for (let i = 0; i < uris.length; i++) {\n    const uri = uris[i].substring(0, uris[i].lastIndexOf(\"/\"));\n    if (baseUri !== uri) {\n      throw new Error(`Can only create batches with the same base URI for every entry in the batch. Expected '${baseUri}' but got '${uri}'`);\n    }\n  }\n\n  // Ensure that baseUri ends with trailing slash\n  return baseUri.replace(/\\/$/, \"\") + \"/\";\n}\nfunction isUriList(metadatas) {\n  return metadatas.find(m => typeof m !== \"string\") === undefined;\n}\nfunction isMetadataList(metadatas) {\n  return metadatas.find(m => typeof m !== \"object\") === undefined;\n}\n\n/**\n * @internal\n */\nconst DEFAULT_QUERY_ALL_COUNT = 100;\n\n/**\n * Pagination Parameters\n * @public\n */\n\nexport { DEFAULT_QUERY_ALL_COUNT as D, FALLBACK_METADATA as F, InterfaceId_IERC721 as I, InterfaceId_IERC1155 as a, uploadOrExtractURI as b, fetchTokenMetadataForContract as c, fetchTokenMetadata as f, getBaseUriFromBatch as g, uploadOrExtractURIs as u };\n","import { aW as NATIVE_TOKEN_ADDRESS } from './index-7c34e233.browser.esm.js';\nimport { i as isNativeToken } from './fetchCurrencyValue-28e612f0.browser.esm.js';\n\n/**\n * @internal\n */\nfunction cleanCurrencyAddress(currencyAddress) {\n  if (isNativeToken(currencyAddress)) {\n    return NATIVE_TOKEN_ADDRESS;\n  }\n  return currencyAddress;\n}\n\nexport { cleanCurrencyAddress as c };\n","/**\n * Allows overriding transaction behavior for this contract\n * @internal\n */\nclass ContractInterceptor {\n  constructor(contractWrapper) {\n    this.contractWrapper = contractWrapper;\n  }\n\n  /**\n   * The next transaction executed will add/replace any overrides passed via the passed in hook.\n   * @remarks Overridden values will be applied to the next transaction executed.\n   * @example\n   * ```javascript\n   * contract.interceptor.overrideNextTransaction(() => ({\n   *   gasLimit: 3000000,\n   * }));\n   * ```\n   * @param hook - the hook to add or replace any CallOverrides (gas limit, gas price, nonce, from, value, etc...)\n   * @public\n   */\n  overrideNextTransaction(hook) {\n    this.contractWrapper.withTransactionOverride(hook);\n  }\n}\n\nexport { ContractInterceptor as C };\n","import { f as buildTransactionFunction, T as Transaction } from './transactions-08c76744.browser.esm.js';\nimport { dr as FEATURE_PLATFORM_FEE, bH as CommonPlatformFeeSchema } from './index-7c34e233.browser.esm.js';\n\n/**\n * Handle platform fees and recipients\n * @remarks Configure platform fees for a contract, which can be applied on certain paid transactions\n * @example\n * ```javascript\n * const contract = await sdk.getContract(\"{{contract_address}}\");\n * const feeInfo = await contract.platformFees.get();\n * await contract.platformFees.set({\n *   platform_fee_basis_points: 100, // 1% fee\n *   platform_fee_recipient: \"0x...\" // the fee recipient\n * })\n * ```\n * @public\n */\nclass ContractPlatformFee {\n  featureName = FEATURE_PLATFORM_FEE.name;\n  constructor(contractWrapper) {\n    this.contractWrapper = contractWrapper;\n  }\n\n  /**\n   * Get the platform fee recipient and basis points\n   *\n   * @example\n   * ```javascript\n   * const feeInfo = await contract.platformFees.get();\n   * console.log(feeInfo.platform_fee_recipient);\n   * console.log(feeInfo.platform_fee_basis_points);\n   * ```\n   * @twfeature PlatformFee\n   */\n  async get() {\n    const [platformFeeRecipient, platformFeeBps] = await this.contractWrapper.read(\"getPlatformFeeInfo\", []);\n    return CommonPlatformFeeSchema.parseAsync({\n      platform_fee_recipient: platformFeeRecipient,\n      platform_fee_basis_points: platformFeeBps\n    });\n  }\n\n  /**\n   * Set the platform fee recipient and basis points\n   *\n   * @example\n   * ```javascript\n   * await contract.platformFees.set({\n   *   platform_fee_basis_points: 100, // 1% fee\n   *   platform_fee_recipient: \"0x...\" // the fee recipient\n   * })\n   * ```\n   *\n   * @param platformFeeInfo - the platform fee information\n   * @twfeature PlatformFee\n   */\n  set = /* @__PURE__ */buildTransactionFunction(async platformFeeInfo => {\n    const parsed = await CommonPlatformFeeSchema.parseAsync(platformFeeInfo);\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"setPlatformFeeInfo\",\n      args: [parsed.platform_fee_recipient, parsed.platform_fee_basis_points]\n    });\n  });\n}\n\nexport { ContractPlatformFee as C };\n","import invariant from 'tiny-invariant';\nimport { d1 as FEATURE_PERMISSIONS, H as getRoleHash, aM as resolveAddress, o as MissingRoleError } from './index-7c34e233.browser.esm.js';\nimport { h as hasFunction } from './contract-appuri-74125478.browser.esm.js';\nimport { f as buildTransactionFunction, T as Transaction } from './transactions-08c76744.browser.esm.js';\nimport { C as ContractEncoder } from './fetchCurrencyValue-28e612f0.browser.esm.js';\n\n/**\n * Handle contract permissions\n * @remarks Configure roles and permissions for a contract, to restrict certain actions.\n * @example\n * ```javascript\n * const contract = await sdk.getContract(\"{{contract_address}}\");\n * const rolesAndMembers = await contract.roles.getAll();\n * await contract.roles.grantRole(\"admin\", \"0x...\");\n * ```\n * @public\n */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars -- TO BE REMOVED IN V4\nclass ContractRoles {\n  featureName = FEATURE_PERMISSIONS.name;\n\n  /**\n   * @internal\n   * @remarks This is used for typing inside react hooks which is why it has to be public.\n   */\n\n  constructor(contractWrapper, roles) {\n    this.contractWrapper = contractWrapper;\n    this.roles = roles;\n  }\n\n  /** **************************\n   * READ FUNCTIONS\n   ****************************/\n\n  /**\n   * Get all members of all roles\n   * @remarks See {@link ContractRoles.get} to get a list of addresses that are members of a specific role.\n   * @example\n   * ```javascript\n   * const rolesAndMembers = await contract.roles.getAll();\n   * ```\n   * @returns A record of {@link Role}s to lists of addresses that are members of the given role.\n   * @throws If the contract does not support roles this will throw an error.\n   *\n   * @public\n   * @twfeature PermissionsEnumerable\n   */\n  async getAll() {\n    invariant(this.roles.length, \"this contract has no support for roles\");\n    const roles = {};\n    const entries = Object.entries(this.roles);\n    (await Promise.all(entries.map(_ref => {\n      let [, role] = _ref;\n      return this.get(role);\n    }))).forEach((item, index) => roles[entries[index][1]] = item);\n    return roles;\n  }\n\n  /**\n   * Get all members of a specific role\n   * @remarks See {@link ContractRoles.getAll} to get get a list of addresses for all supported roles on the contract.\n   * @param role - The Role to to get a memberlist for.\n   * @returns The list of addresses that are members of the specific role.\n   * @throws If you are requesting a role that does not exist on the contract this will throw an error.\n   *\n   * @example Say you want to get the list of addresses that are members of the minter role.\n   * ```javascript\n   * const minterAddresses = await contract.roles.get(\"minter\");\n   * ```\n   *\n   * @public\n   * @twfeature Permissions\n   */\n  async get(role) {\n    invariant(this.roles.includes(role), `this contract does not support the \"${role}\" role`);\n    const wrapper = this.contractWrapper;\n    if (hasFunction(\"getRoleMemberCount\", wrapper) && hasFunction(\"getRoleMember\", wrapper)) {\n      const roleHash = getRoleHash(role);\n      const count = (await wrapper.read(\"getRoleMemberCount\", [roleHash])).toNumber();\n      return await Promise.all(Array.from(Array(count).keys()).map(i => wrapper.read(\"getRoleMember\", [roleHash, i])));\n    }\n    throw new Error(\"Contract does not support enumerating roles. Please implement IPermissionsEnumerable to unlock this functionality.\");\n  }\n\n  /**\n   * Overwrite the list of members for specific roles\n   *\n   * @remarks Every role in the list will be overwritten with the new list of addresses provided with them.\n   * If you want to add or remove addresses for a single address use {@link ContractRoles.grant} and {@link ContractRoles.revoke} respectively instead.\n   * @param rolesWithAddresses - A record of {@link Role}s to lists of addresses that should be members of the given role.\n   * @throws If you are requesting a role that does not exist on the contract this will throw an error.\n   * @example Say you want to overwrite the list of addresses that are members of the minter role.\n   * ```javascript\n   * const minterAddresses = await contract.roles.get(\"minter\");\n   * await contract.roles.setAll({\n   *  minter: []\n   * });\n   * console.log(await contract.roles.get(\"minter\")); // No matter what members had the role before, the new list will be set to []\n   * ```\n   * @public\n   * @twfeature Permissions\n   *\n   * */\n  setAll = /* @__PURE__ */buildTransactionFunction(async (rolesWithAddresses, actingAddress) => {\n    // if we are removing multiple roles, we need to allways remove the connected wallet address *last*\n    // this is so we don't renounce (i.e.)  admin role first and then try to revoke someone else's (i.e.) admin role after (which will revert the entire txn because we are no longer an admin)\n    // if it is explicitly passed in (i.e. for estimation) we use that value, otherwise we get it from the connected signer\n    const connectedWalletAddress = actingAddress || (await this.contractWrapper.getSignerAddress());\n    const contractEncoder = new ContractEncoder(this.contractWrapper);\n    const roles = Object.keys(rolesWithAddresses);\n    invariant(roles.length, \"you must provide at least one role to set\");\n    invariant(roles.every(role => this.roles.includes(role)), \"this contract does not support the given role\");\n    const currentRoles = await this.getAll();\n    const encoded = [];\n    // add / remove admin role at the end so we don't revoke admin then grant\n    const sortedRoles = roles.sort(role => role === \"admin\" ? 1 : -1);\n    for (let i = 0; i < sortedRoles.length; i++) {\n      const role = sortedRoles[i];\n      const [addresses, currentAddresses] = await Promise.all([Promise.all(rolesWithAddresses[role]?.map(addressOrEns => resolveAddress(addressOrEns)) || []), Promise.all(currentRoles[role]?.map(addressOrEns => resolveAddress(addressOrEns)) || [])]);\n      const toAdd = addresses.filter(address => !currentAddresses.includes(address));\n      const toRemove = currentAddresses.filter(address => !addresses.includes(address));\n\n      // if we're removing more than one address we have to make sure we always remove the *connected* (acting) wallet address first\n      // otherwise we'll revoke the connected wallet address and then try to revoke someone else's address which will revert the entire txn\n      if (toRemove.length > 1) {\n        const index = toRemove.indexOf(connectedWalletAddress);\n        if (index > -1) {\n          toRemove.splice(index, 1);\n          toRemove.push(connectedWalletAddress);\n        }\n      }\n      if (toAdd.length) {\n        toAdd.forEach(address => {\n          encoded.push(contractEncoder.encode(\"grantRole\", [getRoleHash(role), address]));\n        });\n      }\n      if (toRemove.length) {\n        const revokeFunctionNames = await Promise.all(toRemove.map(address => this.getRevokeRoleFunctionName(address)));\n        revokeFunctionNames.forEach((revokeFunctionName, index) => encoded.push(contractEncoder.encode(revokeFunctionName, [getRoleHash(role), toRemove[index]])));\n      }\n    }\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [encoded]\n    });\n  });\n\n  /**\n   * Throws an error if an address is missing the roles specified.\n   *\n   * @param roles - The roles to check\n   * @param address - The address to check\n   *\n   * @internal\n   */\n  async verify(roles, address) {\n    await Promise.all(roles.map(async role => {\n      const [members, resolvedAddress] = await Promise.all([this.get(role), resolveAddress(address)]);\n      if (!members.map(a => a.toLowerCase()).includes(resolvedAddress.toLowerCase())) {\n        throw new MissingRoleError(resolvedAddress, role);\n      }\n    }));\n  }\n\n  /** **************************\n   * WRITE FUNCTIONS\n   ****************************/\n\n  /**\n   * Grant a role to a specific address\n   *\n   * @remarks Make sure you are sure you want to grant the role to the address.\n   *\n   * @example\n   * ```javascript\n   * await contract.roles.grant(\"minter\", \"{{wallet_address}}\");\n   * ```\n   *\n   * @param role - The {@link Role} to grant to the address\n   * @param address - The address to grant the role to\n   * @returns The transaction receipt\n   * @throws If you are trying to grant does not exist on the contract this will throw an error.\n   *\n   * @public\n   * @twfeature Permissions\n   */\n  grant = /* @__PURE__ */buildTransactionFunction(async (role, address) => {\n    invariant(this.roles.includes(role), `this contract does not support the \"${role}\" role`);\n    const resolvedAddress = await resolveAddress(address);\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"grantRole\",\n      args: [getRoleHash(role), resolvedAddress]\n    });\n  });\n\n  /**\n   * Revoke a role from a specific address\n   *\n   * @remarks\n   *\n   * -- Caution --\n   *\n   * This will let you remove yourself from the role, too.\n   * If you remove yourself from the admin role, you will no longer be able to administer the contract.\n   * There is no way to recover from this.\n   *\n   * @example\n   * ```javascript\n   * await contract.roles.revoke(\"minter\", \"{{wallet_address}}\");\n   * ```\n   *\n   * @param role - The {@link Role} to revoke\n   * @param address - The address to revoke the role from\n   * @returns The transaction receipt\n   * @throws If you are trying to revoke does not exist on the module this will throw an error.\n   *\n   * @public\n   * @twfeature Permissions\n   */\n  revoke = /* @__PURE__ */buildTransactionFunction(async (role, address) => {\n    invariant(this.roles.includes(role), `this contract does not support the \"${role}\" role`);\n    const resolvedAddress = await resolveAddress(address);\n    const revokeFunctionName = await this.getRevokeRoleFunctionName(resolvedAddress);\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: revokeFunctionName,\n      args: [getRoleHash(role), resolvedAddress]\n    });\n  });\n\n  /** **************************\n   * PRIVATE FUNCTIONS\n   ****************************/\n\n  async getRevokeRoleFunctionName(address) {\n    const [resolvedAddress, signerAddress] = await Promise.all([resolveAddress(address), this.contractWrapper.getSignerAddress()]);\n    if (signerAddress.toLowerCase() === resolvedAddress.toLowerCase()) {\n      return \"renounceRole\";\n    }\n    return \"revokeRole\";\n  }\n}\n\nexport { ContractRoles as C };\n","let ListingType = /*#__PURE__*/function (ListingType) {\n  ListingType[ListingType[\"Direct\"] = 0] = \"Direct\";\n  ListingType[ListingType[\"Auction\"] = 1] = \"Auction\";\n  return ListingType;\n}({});\n\nexport { ListingType as L };\n","import { BigNumber, constants, utils, Contract } from 'ethers';\nimport invariant from 'tiny-invariant';\nimport { c as fetchTokenMetadataForContract, I as InterfaceId_IERC721, a as InterfaceId_IERC1155, D as DEFAULT_QUERY_ALL_COUNT } from './QueryParams-232cc4d3.browser.esm.js';\nimport { C as ContractEncoder, f as fetchCurrencyMetadata, a as fetchCurrencyValue, i as isNativeToken } from './fetchCurrencyValue-28e612f0.browser.esm.js';\nimport { L as ListingNotFoundError, W as WrongListingTypeError, aM as resolveAddress, t as AuctionAlreadyStartedError, w as AuctionHasNotEndedError, dE as MARKETPLACE_CONTRACT_ROLES, cs as ContractWrapper, bk as AbiSchema, b$ as MarketplaceContractSchema, H as getRoleHash, aX as NATIVE_TOKENS } from './index-7c34e233.browser.esm.js';\nimport { m as mapOffer, v as validateNewListingParam, h as handleTokenApproval, a as isWinningBid, i as isTokenApprovedForTransfer } from './marketplace-6ed5a4ea.browser.esm.js';\nimport { f as buildTransactionFunction, T as Transaction } from './transactions-08c76744.browser.esm.js';\nimport { a as ContractEvents, C as ContractMetadata, b as ContractAppURI, G as GasCostEstimator } from './contract-appuri-74125478.browser.esm.js';\nimport { C as ContractInterceptor } from './contract-interceptor-d7b164a7.browser.esm.js';\nimport { C as ContractPlatformFee } from './contract-platform-fee-b2e53cfb.browser.esm.js';\nimport { C as ContractRoles } from './contract-roles-a1bd9cb8.browser.esm.js';\nimport { c as cleanCurrencyAddress } from './cleanCurrencyAddress-8dc58c8d.browser.esm.js';\nimport { n as normalizePriceValue } from './normalizePriceValue-80c7eb51.browser.esm.js';\nimport { s as setErc20Allowance } from './setErc20Allowance-13dbcc30.browser.esm.js';\nimport { L as ListingType } from './ListingType-cba090cb.browser.esm.js';\nimport 'zod';\nimport '@thirdweb-dev/chains';\nimport '@thirdweb-dev/crypto';\nimport 'bn.js';\nimport 'bs58';\nimport '@thirdweb-dev/contracts-js/dist/abis/IBurnableERC20.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDrop.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDropERC20_V2.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase_V1.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC20.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC20Permit.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IMintableERC20.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IMulticall.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC20.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC20Metadata.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IBurnableERC721.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IClaimableERC721.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDelayedReveal.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDropERC721_V3.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC721.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC721Enumerable.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC721AQueryableUpgradeable.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC721Supply.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/ILazyMint.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IMintableERC721.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC721.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC721_V1.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/LazyMintWithTier_V1.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/SharedMetadata.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/zora_IERC721Drop.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/ILoyaltyCard.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/INFTMetadata.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC721Metadata.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IBurnableERC1155.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IClaimableERC1155.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDrop1155.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDropERC1155_V2.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase1155.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDropSinglePhase1155_V1.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC1155.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC1155Metadata.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC1155Supply.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC1155Enumerable.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IMintableERC1155.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/ISignatureMintERC1155.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IERC2771Context.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IAppURI.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IContractMetadata.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IDirectListings.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IEnglishAuctions.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IOffers.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IPackVRFDirect.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IPermissions.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IPermissionsEnumerable.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IPlatformFee.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IPrimarySale.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IRoyalty.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/Ownable.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IAirdropERC20.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IAirdropERC721.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IAirdropERC1155.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IAccountFactoryCore.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IAccountPermissions.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IAccountPermissions_V1.json';\nimport '@thirdweb-dev/contracts-js/dist/abis/IAccount.json';\nimport 'ethers/lib/utils';\nimport 'eventemitter3';\nimport '@thirdweb-dev/storage';\n\n/**\n * Handles auction listings\n * @public\n */\nclass MarketplaceAuction {\n  constructor(contractWrapper, storage) {\n    this.contractWrapper = contractWrapper;\n    this.storage = storage;\n    this.encoder = new ContractEncoder(contractWrapper);\n  }\n  getAddress() {\n    return this.contractWrapper.address;\n  }\n\n  /** ******************************\n   * READ FUNCTIONS\n   *******************************/\n\n  /**\n   * Get an Auction listing by id\n   *\n   * @param listingId - the listing Id\n   * @returns The Auction listing object\n   */\n  async getListing(listingId) {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.listingId.toString() !== listingId.toString()) {\n      throw new ListingNotFoundError(this.getAddress(), listingId.toString());\n    }\n    if (listing.listingType !== ListingType.Auction) {\n      throw new WrongListingTypeError(this.getAddress(), listingId.toString(), \"Direct\", \"Auction\");\n    }\n    return await this.mapListing(listing);\n  }\n\n  /**\n   * Get Highest Bid\n   *\n   * @remarks Get the current highest bid of an active auction.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction that closed\n   * const listingId = 0;\n   *\n   * contract.auction.\n   *   .getWinningBid(listingId)\n   *   .then((offer) => console.log(offer))\n   *   .catch((err) => console.error(err));\n   * ```\n   */\n  async getWinningBid(listingId) {\n    await this.validateListing(BigNumber.from(listingId));\n    const offers = await this.contractWrapper.read(\"winningBid\", [listingId]);\n    if (offers.offeror === constants.AddressZero) {\n      return undefined;\n    }\n    return await mapOffer(this.contractWrapper.getProvider(), BigNumber.from(listingId), offers);\n  }\n\n  /**\n   * Get Auction Winner\n   *\n   * @remarks Get the winner of the auction after an auction ends.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction that closed\n   * const listingId = 0;\n   *\n   * contract.auction.\n   *   .getWinner(listingId)\n   *   .then((auctionWinner) => console.log(auctionWinner))\n   *   .catch((err) => console.error(err));\n   * ```\n   */\n  async getWinner(listingId) {\n    const listing = await this.validateListing(BigNumber.from(listingId));\n    const offers = await this.contractWrapper.read(\"winningBid\", [listingId]);\n    const now = BigNumber.from(Math.floor(Date.now() / 1000));\n    const endTime = BigNumber.from(listing.endTimeInEpochSeconds);\n\n    // if we have a winner in the map and the current time is past the endtime of the auction return the address of the winner\n    if (now.gt(endTime) && offers.offeror !== constants.AddressZero) {\n      return offers.offeror;\n    }\n    // otherwise fall back to query filter things\n\n    // TODO this should be via indexer or direct contract call\n    const contractEvents = new ContractEvents(this.contractWrapper);\n    const closedAuctions = await contractEvents.getEvents(\"AuctionClosed\");\n    const auction = closedAuctions.find(a => a.data.listingId.eq(BigNumber.from(listingId)));\n    if (!auction) {\n      throw new Error(`Could not find auction with listingId ${listingId} in closed auctions`);\n    }\n    return auction.data.winningBidder;\n  }\n\n  /** ******************************\n   * WRITE FUNCTIONS\n   *******************************/\n\n  /**\n   * Create Auction\n   *\n   * @remarks Create a new auction where people can bid on an asset.\n   *\n   * @example\n   * ```javascript\n   * // Data of the auction you want to create\n   * const auction = {\n   *   // address of the contract the asset you want to list is on\n   *   assetContractAddress: \"0x...\",\n   *   // token ID of the asset you want to list\n   *   tokenId: \"0\",\n   *  // when should the listing open up for offers\n   *   startTimestamp: new Date(),\n   *   // how long the listing will be open for\n   *   listingDurationInSeconds: 86400,\n   *   // how many of the asset you want to list\n   *   quantity: 1,\n   *   // address of the currency contract that will be used to pay for the listing\n   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,\n   *   // how much people would have to bid to instantly buy the asset\n   *   buyoutPricePerToken: \"10\",\n   *   // the minimum bid that will be accepted for the token\n   *   reservePricePerToken: \"1.5\",\n   * }\n   *\n   * const tx = await contract.auction.createListing(auction);\n   * const receipt = tx.receipt; // the transaction receipt\n   * const id = tx.id; // the id of the newly created listing\n   * ```\n   */\n  createListing = /* @__PURE__ */buildTransactionFunction(async listing => {\n    validateNewListingParam(listing);\n    const resolvedAssetAddress = await resolveAddress(listing.assetContractAddress);\n    const resolvedCurrencyAddress = await resolveAddress(listing.currencyContractAddress);\n    await handleTokenApproval(this.contractWrapper, this.getAddress(), resolvedAssetAddress, listing.tokenId, await this.contractWrapper.getSignerAddress());\n    const normalizedPricePerToken = await normalizePriceValue(this.contractWrapper.getProvider(), listing.buyoutPricePerToken, resolvedCurrencyAddress);\n    const normalizedReservePrice = await normalizePriceValue(this.contractWrapper.getProvider(), listing.reservePricePerToken, resolvedCurrencyAddress);\n    let listingStartTime = Math.floor(listing.startTimestamp.getTime() / 1000);\n    const block = await this.contractWrapper.getProvider().getBlock(\"latest\");\n    const blockTime = block.timestamp;\n    if (listingStartTime < blockTime) {\n      listingStartTime = blockTime;\n    }\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"createListing\",\n      args: [{\n        assetContract: resolvedAssetAddress,\n        tokenId: listing.tokenId,\n        buyoutPricePerToken: normalizedPricePerToken,\n        currencyToAccept: cleanCurrencyAddress(resolvedCurrencyAddress),\n        listingType: ListingType.Auction,\n        quantityToList: listing.quantity,\n        reservePricePerToken: normalizedReservePrice,\n        secondsUntilEndTime: listing.listingDurationInSeconds,\n        startTime: BigNumber.from(listingStartTime)\n      }],\n      parse: receipt => {\n        const event = this.contractWrapper.parseLogs(\"ListingAdded\", receipt?.logs);\n        return {\n          id: event[0].args.listingId,\n          receipt\n        };\n      }\n    });\n  });\n\n  /**\n   * Create a batch of new auctions\n   *\n   * @remarks Create a batch of new auctions on the marketplace\n   *\n   * @example\n   * ```javascript\n   * const auctions = [...];\n   * const tx = await contract.auction.createListingsBatch(auctions);\n   * ```\n   */\n  createListingsBatch = /* @__PURE__ */buildTransactionFunction(async listings => {\n    const data = (await Promise.all(listings.map(listing => this.createListing.prepare(listing)))).map(tx => tx.encode());\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [data],\n      parse: receipt => {\n        const events = this.contractWrapper.parseLogs(\"ListingAdded\", receipt?.logs);\n        return events.map(event => {\n          return {\n            id: event.args.listingId,\n            receipt\n          };\n        });\n      }\n    });\n  });\n\n  /**\n   * Buyout Auction\n   *\n   * @remarks Buy a specific direct listing from the marketplace.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to buy\n   * const listingId = 0;\n   *\n   * await contract.auction.buyoutListing(listingId);\n   * ```\n   */\n  buyoutListing = /* @__PURE__ */buildTransactionFunction(async listingId => {\n    const listing = await this.validateListing(BigNumber.from(listingId));\n    const currencyMetadata = await fetchCurrencyMetadata(this.contractWrapper.getProvider(), listing.currencyContractAddress);\n    return this.makeBid.prepare(listingId, utils.formatUnits(listing.buyoutPrice, currencyMetadata.decimals));\n  });\n\n  /**\n   * Bid On Auction\n   *\n   * @remarks Make a bid on an auction listing\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to bid on\n   * const listingId = 0;\n   * // The price you are willing to bid for a single token of the listing\n   * const pricePerToken = 1;\n   *\n   * await contract.auction.makeBid(listingId, pricePerToken);\n   * ```\n   */\n  makeBid = /* @__PURE__ */buildTransactionFunction(async (listingId, pricePerToken) => {\n    const listing = await this.validateListing(BigNumber.from(listingId));\n    const normalizedPrice = await normalizePriceValue(this.contractWrapper.getProvider(), pricePerToken, listing.currencyContractAddress);\n    if (normalizedPrice.eq(BigNumber.from(0))) {\n      throw new Error(\"Cannot make a bid with 0 value\");\n    }\n    const bidBuffer = await this.contractWrapper.read(\"bidBufferBps\", []);\n    const winningBid = await this.getWinningBid(listingId);\n    if (winningBid) {\n      const isWinner = isWinningBid(winningBid.pricePerToken, normalizedPrice, bidBuffer);\n      invariant(isWinner, \"Bid price is too low based on the current winning bid and the bid buffer\");\n    } else {\n      const tokenPrice = normalizedPrice;\n      const reservePrice = BigNumber.from(listing.reservePrice);\n      invariant(tokenPrice.gte(reservePrice), \"Bid price is too low based on reserve price\");\n    }\n    const quantity = BigNumber.from(listing.quantity);\n    const value = normalizedPrice.mul(quantity);\n    const overrides = (await this.contractWrapper.getCallOverrides()) || {};\n    await setErc20Allowance(this.contractWrapper, value, listing.currencyContractAddress, overrides);\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"offer\",\n      args: [listingId, listing.quantity, listing.currencyContractAddress, normalizedPrice, constants.MaxUint256],\n      overrides\n    });\n  });\n\n  /**\n   * Cancel Auction Listing\n   *\n   * @remarks Cancel an auction listing on the marketplace\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction listing you want to cancel\n   * const listingId = \"0\";\n   *\n   * await contract.auction.cancelListing(listingId);\n   * ```\n   */\n  cancelListing = /* @__PURE__ */buildTransactionFunction(async listingId => {\n    const listing = await this.validateListing(BigNumber.from(listingId));\n    const now = BigNumber.from(Math.floor(Date.now() / 1000));\n    const startTime = BigNumber.from(listing.startTimeInEpochSeconds);\n    const offers = await this.contractWrapper.read(\"winningBid\", [listingId]);\n    if (now.gt(startTime) && offers.offeror !== constants.AddressZero) {\n      throw new AuctionAlreadyStartedError(listingId.toString());\n    }\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"closeAuction\",\n      args: [BigNumber.from(listingId), await this.contractWrapper.getSignerAddress()]\n    });\n  });\n\n  /**\n   * Close the Auction for the buyer or the seller\n   *\n   * @remarks Closes the Auction and executes the sale for the buyer or the seller.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction listing you want to close\n   * const listingId = \"0\";\n   * await contract.auction.closeListing(listingId);\n   * ```\n   *\n   * @param listingId - the auction  listing ud to close\n   * @param closeFor - optionally pass the auction creator address or winning bid offeror address to close the auction on their behalf\n   */\n  closeListing = /* @__PURE__ */buildTransactionFunction(async (listingId, closeFor) => {\n    if (!closeFor) {\n      closeFor = await this.contractWrapper.getSignerAddress();\n    }\n    const listing = await this.validateListing(BigNumber.from(listingId));\n    try {\n      return Transaction.fromContractWrapper({\n        contractWrapper: this.contractWrapper,\n        method: \"closeAuction\",\n        args: [BigNumber.from(listingId), closeFor]\n      });\n    } catch (err) {\n      if (err.message.includes(\"cannot close auction before it has ended\")) {\n        throw new AuctionHasNotEndedError(listingId.toString(), listing.endTimeInEpochSeconds.toString());\n      } else {\n        throw err;\n      }\n    }\n  });\n\n  /**\n   * Execute the Auction Sale\n   *\n   * @remarks Closes the Auction and executes the sale for both parties.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction listing you want to close\n   * const listingId = \"0\";\n   * await contract.auction.executeSale(listingId);\n   * ```\n   *\n   * @param listingId - the auction  listing ud to close\n   */\n  executeSale = /* @__PURE__ */buildTransactionFunction(async listingId => {\n    const listing = await this.validateListing(BigNumber.from(listingId));\n    try {\n      const winningBid = await this.getWinningBid(listingId);\n      invariant(winningBid, \"No winning bid found\");\n      const closeForSeller = this.encoder.encode(\"closeAuction\", [listingId, listing.sellerAddress]);\n      const closeForBuyer = this.encoder.encode(\"closeAuction\", [listingId, winningBid.buyerAddress]);\n      return Transaction.fromContractWrapper({\n        contractWrapper: this.contractWrapper,\n        method: \"multicall\",\n        args: [closeForSeller, closeForBuyer]\n      });\n    } catch (err) {\n      if (err.message.includes(\"cannot close auction before it has ended\")) {\n        throw new AuctionHasNotEndedError(listingId.toString(), listing.endTimeInEpochSeconds.toString());\n      } else {\n        throw err;\n      }\n    }\n  });\n\n  /**\n   * Update an Auction listing with new metadata\n   * @param listing - the listing id to update\n   */\n  updateListing = /* @__PURE__ */buildTransactionFunction(async listing => {\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"updateListing\",\n      args: [listing.id, listing.quantity, listing.reservePrice, listing.buyoutPrice, listing.currencyContractAddress, listing.startTimeInEpochSeconds, listing.endTimeInEpochSeconds]\n    });\n  });\n\n  /**\n   * Get the buffer in basis points between offers\n   */\n  async getBidBufferBps() {\n    return this.contractWrapper.read(\"bidBufferBps\", []);\n  }\n\n  /**\n   * returns the minimum bid a user can place to outbid the previous highest bid\n   * @param listingId - the listing id of the auction\n   */\n  async getMinimumNextBid(listingId) {\n    // we can fetch all of these at the same time using promise.all\n    const [currentBidBufferBps, winningBid, listing] = await Promise.all([this.getBidBufferBps(), this.getWinningBid(listingId), this.validateListing(BigNumber.from(listingId))]);\n    const currentBidOrReservePrice = winningBid ?\n    // if there is a winning bid use the value of it\n    winningBid.currencyValue.value :\n    // if there is no winning bid use the reserve price\n    listing.reservePrice;\n    const minimumNextBid = currentBidOrReservePrice.add(\n    // the addition of the current bid and the buffer\n    // (have to divide by 10000 to get the fraction of the buffer (since it's in basis points))\n    currentBidOrReservePrice.mul(currentBidBufferBps).div(10000));\n\n    // it's more useful to return a currency value here\n    return fetchCurrencyValue(this.contractWrapper.getProvider(), listing.currencyContractAddress, minimumNextBid);\n  }\n\n  /** ******************************\n   * PRIVATE FUNCTIONS\n   *******************************/\n\n  /**\n   * Throws error if listing could not be found\n   *\n   * @param listingId - Listing to check for\n   */\n  async validateListing(listingId) {\n    try {\n      return await this.getListing(listingId);\n    } catch (err) {\n      console.error(`Error getting the listing with id ${listingId}`);\n      throw err;\n    }\n  }\n\n  /**\n   * Helper method maps the auction listing to the auction listing interface.\n   *\n   * @internal\n   * @param listing - The listing to map, as returned from the contract.\n   * @returns  The mapped interface.\n   */\n  async mapListing(listing) {\n    return {\n      assetContractAddress: listing.assetContract,\n      buyoutPrice: BigNumber.from(listing.buyoutPricePerToken),\n      currencyContractAddress: listing.currency,\n      buyoutCurrencyValuePerToken: await fetchCurrencyValue(this.contractWrapper.getProvider(), listing.currency, listing.buyoutPricePerToken),\n      id: listing.listingId.toString(),\n      tokenId: listing.tokenId,\n      quantity: listing.quantity,\n      startTimeInEpochSeconds: listing.startTime,\n      asset: await fetchTokenMetadataForContract(listing.assetContract, this.contractWrapper.getProvider(), listing.tokenId, this.storage),\n      reservePriceCurrencyValuePerToken: await fetchCurrencyValue(this.contractWrapper.getProvider(), listing.currency, listing.reservePricePerToken),\n      reservePrice: BigNumber.from(listing.reservePricePerToken),\n      endTimeInEpochSeconds: listing.endTime,\n      sellerAddress: listing.tokenOwner,\n      type: ListingType.Auction\n    };\n  }\n}\n\n/**\n * Handles direct listings\n * @public\n */\nclass MarketplaceDirect {\n  constructor(contractWrapper, storage) {\n    this.contractWrapper = contractWrapper;\n    this.storage = storage;\n  }\n  getAddress() {\n    return this.contractWrapper.address;\n  }\n\n  /** ******************************\n   * READ FUNCTIONS\n   *******************************/\n\n  /**\n   * Get a direct listing by id\n   *\n   * @param listingId - the listing id\n   * @returns The Direct listing object\n   */\n  async getListing(listingId) {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.assetContract === constants.AddressZero) {\n      throw new ListingNotFoundError(this.getAddress(), listingId.toString());\n    }\n    if (listing.listingType !== ListingType.Direct) {\n      throw new WrongListingTypeError(this.getAddress(), listingId.toString(), \"Auction\", \"Direct\");\n    }\n    return await this.mapListing(listing);\n  }\n\n  /**\n   * Get the active offer on a listing\n   * @param listingId - the listing id\n   * @param address - the address that made the offer\n   */\n  async getActiveOffer(listingId, address) {\n    await this.validateListing(BigNumber.from(listingId));\n    invariant(utils.isAddress(address), \"Address must be a valid address\");\n    const offers = await this.contractWrapper.read(\"offers\", [listingId, await resolveAddress(address)]);\n    if (offers.offeror === constants.AddressZero) {\n      return undefined;\n    }\n    return await mapOffer(this.contractWrapper.getProvider(), BigNumber.from(listingId), offers);\n  }\n\n  /** ******************************\n   * WRITE FUNCTIONS\n   *******************************/\n\n  /**\n   * Create Direct Listing\n   *\n   * @remarks Create a new listing on the marketplace where people can buy an asset directly.\n   *\n   * @example\n   * ```javascript\n   * // Data of the listing you want to create\n   * const listing = {\n   *   // address of the contract the asset you want to list is on\n   *   assetContractAddress: \"0x...\",\n   *   // token ID of the asset you want to list\n   *   tokenId: \"0\",\n   *   // when should the listing open up for offers\n   *   startTimestamp: new Date(),\n   *   // how long the listing will be open for\n   *   listingDurationInSeconds: 86400,\n   *   // how many of the asset you want to list\n   *   quantity: 1,\n   *   // address of the currency contract that will be used to pay for the listing\n   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,\n   *   // how much the asset will be sold for\n   *   buyoutPricePerToken: \"1.5\",\n   * }\n   *\n   * const tx = await contract.direct.createListing(listing);\n   * const receipt = tx.receipt; // the transaction receipt\n   * const id = tx.id; // the id of the newly created listing\n   * ```\n   */\n  createListing = /* @__PURE__ */buildTransactionFunction(async listing => {\n    validateNewListingParam(listing);\n    const resolvedAssetAddress = await resolveAddress(listing.assetContractAddress);\n    const resolvedCurrencyAddress = await resolveAddress(listing.currencyContractAddress);\n    await handleTokenApproval(this.contractWrapper, this.getAddress(), resolvedAssetAddress, listing.tokenId, await this.contractWrapper.getSignerAddress());\n    const normalizedPricePerToken = await normalizePriceValue(this.contractWrapper.getProvider(), listing.buyoutPricePerToken, resolvedCurrencyAddress);\n    let listingStartTime = Math.floor(listing.startTimestamp.getTime() / 1000);\n    const block = await this.contractWrapper.getProvider().getBlock(\"latest\");\n    const blockTime = block.timestamp;\n    if (listingStartTime < blockTime) {\n      listingStartTime = blockTime;\n    }\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"createListing\",\n      args: [{\n        assetContract: resolvedAssetAddress,\n        tokenId: listing.tokenId,\n        buyoutPricePerToken: normalizedPricePerToken,\n        currencyToAccept: cleanCurrencyAddress(resolvedCurrencyAddress),\n        listingType: ListingType.Direct,\n        quantityToList: listing.quantity,\n        reservePricePerToken: normalizedPricePerToken,\n        secondsUntilEndTime: listing.listingDurationInSeconds,\n        startTime: BigNumber.from(listingStartTime)\n      }],\n      parse: receipt => {\n        const event = this.contractWrapper.parseLogs(\"ListingAdded\", receipt?.logs);\n        return {\n          id: event[0].args.listingId,\n          receipt\n        };\n      }\n    });\n  });\n\n  /**\n   * Create a batch of new listings\n   *\n   * @remarks Create a batch of new listings on the marketplace\n   *\n   * @example\n   * ```javascript\n   * const listings = [...];\n   * const tx = await contract.direct.createListingsBatch(listings);\n   * ```\n   */\n  createListingsBatch = /* @__PURE__ */buildTransactionFunction(async listings => {\n    const data = (await Promise.all(listings.map(listing => this.createListing.prepare(listing)))).map(tx => tx.encode());\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [data],\n      parse: receipt => {\n        const events = this.contractWrapper.parseLogs(\"ListingAdded\", receipt?.logs);\n        return events.map(event => {\n          return {\n            id: event.args.listingId,\n            receipt\n          };\n        });\n      }\n    });\n  });\n\n  /**\n   * Make an offer for a Direct Listing\n   *\n   * @remarks Make an offer on a direct listing\n   *\n   * @example\n   * ```javascript\n   * import { ChainId, NATIVE_TOKENS } from \"@thirdweb-dev/sdk\";\n   *\n   * // The listing ID of the asset you want to offer on\n   * const listingId = 0;\n   * // The price you are willing to offer per token\n   * const pricePerToken = 1;\n   * // The quantity of tokens you want to receive for this offer\n   * const quantity = 1;\n   * // The address of the currency you are making the offer in (must be ERC-20)\n   * const currencyContractAddress = NATIVE_TOKENS[ChainId.Rinkeby].wrapped.address\n   *\n   * await contract.direct.makeOffer(\n   *   listingId,\n   *   quantity,\n   *   currencyContractAddress,\n   *   pricePerToken\n   * );\n   * ```\n   */\n  makeOffer = /* @__PURE__ */buildTransactionFunction(async (listingId, quantityDesired, currencyContractAddress, pricePerToken, expirationDate) => {\n    if (isNativeToken(currencyContractAddress)) {\n      throw new Error(\"You must use the wrapped native token address when making an offer with a native token\");\n    }\n    const normalizedPrice = await normalizePriceValue(this.contractWrapper.getProvider(), pricePerToken, currencyContractAddress);\n    try {\n      await this.getListing(listingId);\n    } catch (err) {\n      console.error(\"Failed to get listing, err =\", err);\n      throw new Error(`Error getting the listing with id ${listingId}`);\n    }\n    const quantity = BigNumber.from(quantityDesired);\n    const value = BigNumber.from(normalizedPrice).mul(quantity);\n    const overrides = (await this.contractWrapper.getCallOverrides()) || {};\n    await setErc20Allowance(this.contractWrapper, value, currencyContractAddress, overrides);\n    let expirationTimestamp = constants.MaxUint256;\n    if (expirationDate) {\n      expirationTimestamp = BigNumber.from(Math.floor(expirationDate.getTime() / 1000));\n    }\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"offer\",\n      args: [listingId, quantityDesired, currencyContractAddress, normalizedPrice, expirationTimestamp],\n      overrides\n    });\n  });\n\n  /**\n   * Accept an offer on a direct listing\n   *\n   * @remarks Accept an offer on a direct listing\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to bid on\n   * const listingId = 0;\n   * // The price you are willing to bid for a single token of the listing\n   * const offeror = \"0x...\";\n   *\n   * await contract.direct.acceptOffer(listingId, offeror);\n   * ```\n   */\n  acceptOffer = /* @__PURE__ */buildTransactionFunction(async (listingId, addressOfOfferor) => {\n    /**\n     * TODO:\n     * - Provide better error handling if offer is too low.\n     */\n    await this.validateListing(BigNumber.from(listingId));\n    const resolvedAddress = await resolveAddress(addressOfOfferor);\n    const offer = await this.contractWrapper.read(\"offers\", [listingId, resolvedAddress]);\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"acceptOffer\",\n      args: [listingId, resolvedAddress, offer.currency, offer.pricePerToken]\n    });\n  });\n\n  /**\n   * Buy a Listing\n   *\n   * @remarks Buy a specific direct listing from the marketplace.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to buy\n   * const listingId = 0;\n   * // Quantity of the asset you want to buy\n   * const quantityDesired = 1;\n   *\n   * await contract.direct.buyoutListing(listingId, quantityDesired);\n   * ```\n   *\n   * @param listingId - The listing id to buy\n   * @param quantityDesired - the quantity to buy\n   * @param receiver - optional receiver of the bought listing if different from the connected wallet\n   */\n  buyoutListing = /* @__PURE__ */buildTransactionFunction(async (listingId, quantityDesired, receiver) => {\n    const listing = await this.validateListing(BigNumber.from(listingId));\n    const {\n      valid,\n      error\n    } = await this.isStillValidListing(listing, quantityDesired);\n    if (!valid) {\n      throw new Error(`Listing ${listingId} is no longer valid. ${error}`);\n    }\n    const buyFor = receiver ? receiver : await this.contractWrapper.getSignerAddress();\n    const quantity = BigNumber.from(quantityDesired);\n    const value = BigNumber.from(listing.buyoutPrice).mul(quantity);\n    const overrides = (await this.contractWrapper.getCallOverrides()) || {};\n    await setErc20Allowance(this.contractWrapper, value, listing.currencyContractAddress, overrides);\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"buy\",\n      args: [listingId, buyFor, quantity, listing.currencyContractAddress, value],\n      overrides\n    });\n  });\n\n  /**\n   * Update a Direct listing with new metadata.\n   *\n   * Note: cannot update a listing with a new quantity of 0. Use `cancelDirectListing` to remove a listing instead.\n   *\n   * @param listing - the new listing information\n   */\n  updateListing = /* @__PURE__ */buildTransactionFunction(async listing => {\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"updateListing\",\n      args: [listing.id, listing.quantity, listing.buyoutPrice,\n      // reserve price, doesn't matter for direct listing\n      listing.buyoutPrice, await resolveAddress(listing.currencyContractAddress), listing.startTimeInSeconds, listing.secondsUntilEnd]\n    });\n  });\n\n  /**\n   * Cancel Direct Listing\n   *\n   * @remarks Cancel a direct listing on the marketplace\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the direct listing you want to cancel\n   * const listingId = \"0\";\n   *\n   * await contract.direct.cancelListing(listingId);\n   * ```\n   */\n  cancelListing = /* @__PURE__ */buildTransactionFunction(async listingId => {\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"cancelDirectListing\",\n      args: [listingId]\n    });\n  });\n\n  /** ******************************\n   * PRIVATE FUNCTIONS\n   *******************************/\n\n  /**\n   * Throws error if listing could not be found\n   *\n   * @param listingId - Listing to check for\n   */\n  async validateListing(listingId) {\n    try {\n      return await this.getListing(listingId);\n    } catch (err) {\n      console.error(`Error getting the listing with id ${listingId}`);\n      throw err;\n    }\n  }\n\n  /**\n   * Helper method maps the auction listing to the direct listing interface.\n   *\n   * @internal\n   * @param listing - The listing to map, as returned from the contract.\n   * @returns  The mapped interface.\n   */\n  async mapListing(listing) {\n    return {\n      assetContractAddress: listing.assetContract,\n      buyoutPrice: BigNumber.from(listing.buyoutPricePerToken),\n      currencyContractAddress: listing.currency,\n      buyoutCurrencyValuePerToken: await fetchCurrencyValue(this.contractWrapper.getProvider(), listing.currency, listing.buyoutPricePerToken),\n      id: listing.listingId.toString(),\n      tokenId: listing.tokenId,\n      quantity: listing.quantity,\n      startTimeInSeconds: listing.startTime,\n      asset: await fetchTokenMetadataForContract(listing.assetContract, this.contractWrapper.getProvider(), listing.tokenId, this.storage),\n      secondsUntilEnd: listing.endTime,\n      sellerAddress: listing.tokenOwner,\n      type: ListingType.Direct\n    };\n  }\n\n  /**\n   * Use this method to check if a direct listing is still valid.\n   *\n   * Ways a direct listing can become invalid:\n   * 1. The asset holder transferred the asset to another wallet\n   * 2. The asset holder burned the asset\n   * 3. The asset holder removed the approval on the marketplace\n   *\n   * @internal\n   * @param listing - The listing to check.\n   * @returns  True if the listing is valid, false otherwise.\n   */\n  async isStillValidListing(listing, quantity) {\n    const approved = await isTokenApprovedForTransfer(this.contractWrapper.getProvider(), this.getAddress(), listing.assetContractAddress, listing.tokenId, listing.sellerAddress);\n    if (!approved) {\n      return {\n        valid: false,\n        error: `Token '${listing.tokenId}' from contract '${listing.assetContractAddress}' is not approved for transfer`\n      };\n    }\n    const provider = this.contractWrapper.getProvider();\n    const ERC165Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC165.json')).default;\n    const erc165 = new Contract(listing.assetContractAddress, ERC165Abi, provider);\n    const isERC721 = await erc165.supportsInterface(InterfaceId_IERC721);\n    const isERC1155 = await erc165.supportsInterface(InterfaceId_IERC1155);\n    if (isERC721) {\n      const ERC721Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC721.json')).default;\n      const asset = new Contract(listing.assetContractAddress, ERC721Abi, provider);\n\n      // Handle reverts in case of non-existent tokens\n      let owner;\n      try {\n        owner = await asset.ownerOf(listing.tokenId);\n      } catch (e) {}\n      const valid = owner?.toLowerCase() === listing.sellerAddress.toLowerCase();\n      return {\n        valid,\n        error: valid ? undefined : `Seller is not the owner of Token '${listing.tokenId}' from contract '${listing.assetContractAddress} anymore'`\n      };\n    } else if (isERC1155) {\n      const ERC1155Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC1155.json')).default;\n      const asset = new Contract(listing.assetContractAddress, ERC1155Abi, provider);\n      const balance = await asset.balanceOf(listing.sellerAddress, listing.tokenId);\n      const valid = balance.gte(quantity || listing.quantity);\n      return {\n        valid,\n        error: valid ? undefined : `Seller does not have enough balance of Token '${listing.tokenId}' from contract '${listing.assetContractAddress} to fulfill the listing`\n      };\n    } else {\n      return {\n        valid: false,\n        error: \"Contract does not implement ERC 1155 or ERC 721.\"\n      };\n    }\n  }\n}\n\n/**\n * Create your own whitelabel marketplace that enables users to buy and sell any digital assets.\n *\n * @example\n *\n * ```javascript\n * import { ThirdwebSDK } from \"@thirdweb-dev/sdk\";\n *\n * const sdk = new ThirdwebSDK(\"{{chainName}}\");\n * const contract = await sdk.getContract(\"{{contract_address}}\", \"marketplace\");\n * ```\n *\n * @internal\n * @deprecated use contract.directListings / contract.auctions / contract.offers instead\n */\nclass Marketplace {\n  static contractRoles = MARKETPLACE_CONTRACT_ROLES;\n\n  /**\n   * @internal\n   */\n\n  /**\n   * Direct listings\n   * @remarks Create and manage direct listings in your marketplace.\n   * @example\n   * ```javascript\n   * // Data of the listing you want to create\n   * const listing = {\n   *   // address of the NFT contract the asset you want to list is on\n   *   assetContractAddress: \"0x...\",\n   *   // token ID of the asset you want to list\n   *   tokenId: \"0\",\n   *  // when should the listing open up for offers\n   *   startTimestamp: new Date(),\n   *   // how long the listing will be open for\n   *   listingDurationInSeconds: 86400,\n   *   // how many of the asset you want to list\n   *   quantity: 1,\n   *   // address of the currency contract that will be used to pay for the listing\n   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,\n   *   // how much the asset will be sold for\n   *   buyoutPricePerToken: \"1.5\",\n   * }\n   *\n   * const tx = await contract.direct.createListing(listing);\n   * const receipt = tx.receipt; // the transaction receipt\n   * const listingId = tx.id; // the id of the newly created listing\n   *\n   * // And on the buyers side:\n   * // Quantity of the asset you want to buy\n   * const quantityDesired = 1;\n   * await contract.direct.buyoutListing(listingId, quantityDesired);\n   * ```\n   */\n\n  /**\n   * Auctions\n   * @remarks Create and manage auctions in your marketplace.\n   * @example\n   * ```javascript\n   * // Data of the auction you want to create\n   * const auction = {\n   *   // address of the contract the asset you want to list is on\n   *   assetContractAddress: \"0x...\",\n   *   // token ID of the asset you want to list\n   *   tokenId: \"0\",\n   *  // when should the listing open up for offers\n   *   startTimestamp: new Date(),\n   *   // how long the listing will be open for\n   *   listingDurationInSeconds: 86400,\n   *   // how many of the asset you want to list\n   *   quantity: 1,\n   *   // address of the currency contract that will be used to pay for the listing\n   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,\n   *   // how much people would have to bid to instantly buy the asset\n   *   buyoutPricePerToken: \"10\",\n   *   // the minimum bid that will be accepted for the token\n   *   reservePricePerToken: \"1.5\",\n   * }\n   *\n   * const tx = await contract.auction.createListing(auction);\n   * const receipt = tx.receipt; // the transaction receipt\n   * const listingId = tx.id; // the id of the newly created listing\n   *\n   * // And on the buyers side:\n   * // The price you are willing to bid for a single token of the listing\n   * const pricePerToken = 2.6;\n   * await contract.auction.makeBid(listingId, pricePerToken);\n   * ```\n   */\n\n  get chainId() {\n    return this._chainId;\n  }\n  constructor(network, address, storage) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    let abi = arguments.length > 4 ? arguments[4] : undefined;\n    let chainId = arguments.length > 5 ? arguments[5] : undefined;\n    let contractWrapper = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : new ContractWrapper(network, address, abi, options, storage);\n    this._chainId = chainId;\n    this.abi = AbiSchema.parse(abi || []);\n    this.contractWrapper = contractWrapper;\n    this.storage = storage;\n    this.metadata = new ContractMetadata(this.contractWrapper, MarketplaceContractSchema, this.storage);\n    this.app = new ContractAppURI(this.contractWrapper, this.metadata, this.storage);\n    this.roles = new ContractRoles(this.contractWrapper, Marketplace.contractRoles);\n    this.encoder = new ContractEncoder(this.contractWrapper);\n    this.estimator = new GasCostEstimator(this.contractWrapper);\n    this.direct = new MarketplaceDirect(this.contractWrapper, this.storage);\n    this.auction = new MarketplaceAuction(this.contractWrapper, this.storage);\n    this.events = new ContractEvents(this.contractWrapper);\n    this.platformFees = new ContractPlatformFee(this.contractWrapper);\n    this.interceptor = new ContractInterceptor(this.contractWrapper);\n  }\n  onNetworkUpdated(network) {\n    this.contractWrapper.updateSignerOrProvider(network);\n  }\n  getAddress() {\n    return this.contractWrapper.address;\n  }\n\n  /** ******************************\n   * READ FUNCTIONS\n   *******************************/\n\n  /**\n   * Convenience function to get either a direct or auction listing\n   *\n   * @param listingId - the listing id\n   * @returns either a direct or auction listing\n   *\n   * @remarks Get a listing by its listing id\n   * @example\n   * ```javascript\n   * const listingId = 0;\n   * const listing = await contract.getListing(listingId);\n   * ```\n   */\n  async getListing(listingId) {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.assetContract === constants.AddressZero) {\n      throw new ListingNotFoundError(this.getAddress(), listingId.toString());\n    }\n    switch (listing.listingType) {\n      case ListingType.Auction:\n        {\n          return await this.auction.mapListing(listing);\n        }\n      case ListingType.Direct:\n        {\n          return await this.direct.mapListing(listing);\n        }\n      default:\n        {\n          throw new Error(`Unknown listing type: ${listing.listingType}`);\n        }\n    }\n  }\n\n  /**\n   * Get all active listings\n   *\n   * @remarks Fetch all the active listings from this marketplace contract. An active listing means it can be bought or bid on.\n   * @example\n   * ```javascript\n   * const listings = await contract.getActiveListings();\n   * const priceOfFirstActiveListing = listings[0].price;\n   * ```\n   * @param filter - optional filter parameters\n   */\n  async getActiveListings(filter) {\n    const rawListings = await this.getAllListingsNoFilter(true);\n    const filtered = this.applyFilter(rawListings, filter);\n    const now = BigNumber.from(Math.floor(Date.now() / 1000));\n    return filtered.filter(l => {\n      return l.type === ListingType.Auction && BigNumber.from(l.endTimeInEpochSeconds).gt(now) && BigNumber.from(l.startTimeInEpochSeconds).lte(now) || l.type === ListingType.Direct && BigNumber.from(l.quantity).gt(0);\n    });\n  }\n\n  /**\n   * Get all the listings\n   *\n   * @remarks Fetch all the listings from this marketplace contract, including sold ones.\n   * @example\n   * ```javascript\n   * const listings = await contract.getAllListings();\n   * const priceOfFirstListing = listings[0].price;\n   * ```\n   *\n   * @param filter - optional filter parameters\n   */\n  async getAllListings(filter) {\n    const rawListings = await this.getAllListingsNoFilter(false);\n    return this.applyFilter(rawListings, filter);\n  }\n\n  /**\n   * @internal\n   */\n  getAll = this.getAllListings;\n\n  /**\n   * Get the total number of Listings\n   * @returns The total number listings on the marketplace\n   * @public\n   */\n  async getTotalCount() {\n    return await this.contractWrapper.read(\"totalListings\", []);\n  }\n\n  /**\n   * Get whether listing is restricted only to addresses with the Lister role\n   */\n  async isRestrictedToListerRoleOnly() {\n    const anyoneCanList = await this.contractWrapper.read(\"hasRole\", [getRoleHash(\"lister\"), constants.AddressZero]);\n    return !anyoneCanList;\n  }\n\n  /**\n   * Get the buffer in basis points between offers\n   */\n  async getBidBufferBps() {\n    return this.contractWrapper.read(\"bidBufferBps\", []);\n  }\n\n  /**\n   * get the buffer time in seconds between offers\n   */\n  async getTimeBufferInSeconds() {\n    return this.contractWrapper.read(\"timeBuffer\", []);\n  }\n\n  /**\n   * Get all the offers for a listing\n   *\n   * @remarks Fetch all the offers for a specified direct or auction listing.\n   * @example\n   * ```javascript\n   * const offers = await marketplaceContract.getOffers(listingId);\n   * const firstOffer = offers[0];\n   * ```\n   *\n   * @param listingId - the id of the listing to fetch offers for\n   */\n  async getOffers(listingId) {\n    // get all new offer events from this contract\n    const listingEvents = await this.events.getEvents(\"NewOffer\", {\n      order: \"desc\",\n      filters: {\n        listingId\n      }\n    });\n    // derive the offers from the events\n    return await Promise.all(listingEvents.map(e => {\n      return mapOffer(this.contractWrapper.getProvider(), BigNumber.from(listingId), {\n        quantityWanted: e.data.quantityWanted,\n        pricePerToken: e.data.quantityWanted.gt(0) ? e.data.totalOfferAmount.div(e.data.quantityWanted) : e.data.totalOfferAmount,\n        currency: e.data.currency,\n        offeror: e.data.offeror\n      });\n    }));\n  }\n\n  /** ******************************\n   * WRITE FUNCTIONS\n   *******************************/\n\n  /**\n   * Purchase NFTs\n   * @remarks Buy a Direct or Auction listing on your marketplace.\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to buy\n   * const listingId = 0;\n   * // Quantity of the asset you want to buy\n   * const quantityDesired = 1;\n   *\n   * await contract.buyoutListing(listingId, quantityDesired);\n   * ```\n   * @param listingId - the listing ID of the listing you want to buy\n   * @param quantityDesired - the quantity that you want to buy (for ERC1155 tokens)\n   * @param receiver - optional receiver of the bought listing if different from the connected wallet (for direct listings only)\n   */\n  buyoutListing = /* @__PURE__ */buildTransactionFunction(async (listingId, quantityDesired, receiver) => {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.listingId.toString() !== listingId.toString()) {\n      throw new ListingNotFoundError(this.getAddress(), listingId.toString());\n    }\n    switch (listing.listingType) {\n      case ListingType.Direct:\n        {\n          invariant(quantityDesired !== undefined, \"quantityDesired is required when buying out a direct listing\");\n          return await this.direct.buyoutListing.prepare(listingId, quantityDesired, receiver);\n        }\n      case ListingType.Auction:\n        {\n          return await this.auction.buyoutListing.prepare(listingId);\n        }\n      default:\n        throw Error(`Unknown listing type: ${listing.listingType}`);\n    }\n  });\n\n  /**\n   * Make an offer for a Direct or Auction Listing\n   *\n   * @remarks Make an offer on a direct or auction listing\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to offer on\n   * const listingId = 0;\n   * // The price you are willing to offer per token\n   * const pricePerToken = 0.5;\n   * // The quantity of tokens you want to receive for this offer\n   * const quantity = 1;\n   *\n   * await contract.makeOffer(\n   *   listingId,\n   *   pricePerToken,\n   *   quantity,\n   * );\n   * ```\n   */\n  makeOffer = /* @__PURE__ */buildTransactionFunction(async (listingId, pricePerToken, quantity) => {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.listingId.toString() !== listingId.toString()) {\n      throw new ListingNotFoundError(this.getAddress(), listingId.toString());\n    }\n    const chainId = await this.contractWrapper.getChainID();\n    switch (listing.listingType) {\n      case ListingType.Direct:\n        {\n          invariant(quantity, \"quantity is required when making an offer on a direct listing\");\n          return await this.direct.makeOffer.prepare(listingId, quantity, isNativeToken(listing.currency) ? NATIVE_TOKENS[chainId].wrapped.address : listing.currency, pricePerToken);\n        }\n      case ListingType.Auction:\n        {\n          return await this.auction.makeBid.prepare(listingId, pricePerToken);\n        }\n      default:\n        throw Error(`Unknown listing type: ${listing.listingType}`);\n    }\n  });\n\n  /**\n   * Set the Auction bid buffer\n   * @remarks A percentage (e.g. 5%) in basis points (5% = 500, 100% = 10000). A new bid is considered to be a winning bid only if its bid amount is at least the bid buffer (e.g. 5%) greater than the previous winning bid. This prevents buyers from making very slightly higher bids to win the auctioned items.\n   * @example\n   * ```javascript\n   * // the bid buffer in basis points\n   * const bufferBps = 5_00; // 5%\n   * await contract.setBidBufferBps(bufferBps);\n   * ```\n   * @param bufferBps - the bps value\n   */\n  setBidBufferBps = /* @__PURE__ */buildTransactionFunction(async bufferBps => {\n    await this.roles.verify([\"admin\"], await this.contractWrapper.getSignerAddress());\n    const timeBuffer = await this.getTimeBufferInSeconds();\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"setAuctionBuffers\",\n      args: [timeBuffer, BigNumber.from(bufferBps)]\n    });\n  });\n\n  /**\n   * Set the Auction Time buffer:\n   * @remarks Measured in seconds (e.g. 15 minutes or 900 seconds). If a winning bid is made within the buffer of the auction closing (e.g. 15 minutes within the auction closing), the auction's closing time is increased by the buffer to prevent buyers from making last minute winning bids, and to give time to other buyers to make a higher bid if they wish to.\n   * @example\n   * ```javascript\n   * // the time buffer in seconds\n   * const bufferInSeconds = 60;\n   * await contract.setTimeBufferInSeconds(bufferInSeconds);\n   * ```\n   * @param bufferInSeconds - the seconds value\n   */\n  setTimeBufferInSeconds = /* @__PURE__ */buildTransactionFunction(async bufferInSeconds => {\n    await this.roles.verify([\"admin\"], await this.contractWrapper.getSignerAddress());\n    const bidBuffer = await this.getBidBufferBps();\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"setAuctionBuffers\",\n      args: [BigNumber.from(bufferInSeconds), bidBuffer]\n    });\n  });\n\n  /**\n   * Restrict listing NFTs only from the specified NFT contract address.\n   * It is possible to allow listing from multiple contract addresses.\n   * @param contractAddress - the NFT contract address\n   */\n  allowListingFromSpecificAssetOnly = /* @__PURE__ */buildTransactionFunction(async contractAddress => {\n    const encoded = [];\n    const members = await this.roles.get(\"asset\");\n    if (members.includes(constants.AddressZero)) {\n      encoded.push(this.encoder.encode(\"revokeRole\", [getRoleHash(\"asset\"), constants.AddressZero]));\n    }\n    encoded.push(this.encoder.encode(\"grantRole\", [getRoleHash(\"asset\"), contractAddress]));\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [encoded]\n    });\n  });\n\n  /**\n   * Allow listings from any NFT contract\n   */\n  allowListingFromAnyAsset = /* @__PURE__ */buildTransactionFunction(async () => {\n    const encoded = [];\n    const members = await this.roles.get(\"asset\");\n    for (const addr in members) {\n      encoded.push(this.encoder.encode(\"revokeRole\", [getRoleHash(\"asset\"), addr]));\n    }\n    encoded.push(this.encoder.encode(\"grantRole\", [getRoleHash(\"asset\"), constants.AddressZero]));\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [encoded]\n    });\n  });\n\n  /** ******************************\n   * PRIVATE FUNCTIONS\n   *******************************/\n\n  async getAllListingsNoFilter(filterInvalidListings) {\n    const listings = await Promise.all(Array.from(Array((await this.contractWrapper.read(\"totalListings\", [])).toNumber()).keys()).map(async i => {\n      let listing;\n      try {\n        listing = await this.getListing(i);\n      } catch (err) {\n        if (err instanceof ListingNotFoundError) {\n          return undefined;\n        } else {\n          console.warn(`Failed to get listing ${i}' - skipping. Try 'marketplace.getListing(${i})' to get the underlying error.`);\n          return undefined;\n        }\n      }\n      if (listing.type === ListingType.Auction) {\n        return listing;\n      }\n      if (filterInvalidListings) {\n        const {\n          valid\n        } = await this.direct.isStillValidListing(listing);\n        if (!valid) {\n          return undefined;\n        }\n      }\n      return listing;\n    }));\n    return listings.filter(l => l !== undefined);\n  }\n  applyFilter(listings, filter) {\n    let rawListings = [...listings];\n    const start = BigNumber.from(filter?.start || 0).toNumber();\n    const count = BigNumber.from(filter?.count || DEFAULT_QUERY_ALL_COUNT).toNumber();\n    if (filter) {\n      if (filter.seller) {\n        rawListings = rawListings.filter(seller => seller.sellerAddress.toString().toLowerCase() === filter?.seller?.toString().toLowerCase());\n      }\n      if (filter.tokenContract) {\n        rawListings = rawListings.filter(tokenContract => tokenContract.assetContractAddress.toString().toLowerCase() === filter?.tokenContract?.toString().toLowerCase());\n      }\n      if (filter.tokenId !== undefined) {\n        rawListings = rawListings.filter(tokenContract => tokenContract.tokenId.toString() === filter?.tokenId?.toString());\n      }\n      rawListings = rawListings.filter((_, index) => index >= start);\n      rawListings = rawListings.slice(0, count);\n    }\n    return rawListings;\n  }\n\n  /**\n   * @internal\n   */\n  async prepare(method, args, overrides) {\n    return Transaction.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method,\n      args,\n      overrides\n    });\n  }\n\n  /**\n   * @internal\n   */\n  async call(functionName, args, overrides) {\n    return this.contractWrapper.call(functionName, args, overrides);\n  }\n}\n\nexport { Marketplace };\n","import { Contract, BigNumber } from 'ethers';\nimport invariant from 'tiny-invariant';\nimport { I as InterfaceId_IERC721, a as InterfaceId_IERC1155, D as DEFAULT_QUERY_ALL_COUNT } from './QueryParams-232cc4d3.browser.esm.js';\nimport { cs as ContractWrapper, dB as MAX_BPS } from './index-7c34e233.browser.esm.js';\nimport { a as fetchCurrencyValue } from './fetchCurrencyValue-28e612f0.browser.esm.js';\n\n/**\n * This method checks if the given token is approved for the transferrerContractAddress contract.\n * This is particularly useful for contracts that need to transfer NFTs on the users' behalf\n *\n * @internal\n * @param provider - The connected provider\n * @param transferrerContractAddress - The address of the marketplace contract\n * @param assetContract - The address of the asset contract.\n * @param tokenId - The token id of the token.\n * @param owner - The address of the account that owns the token.\n * @returns  True if the transferrerContractAddress is approved on the token, false otherwise.\n */\nasync function isTokenApprovedForTransfer(provider, transferrerContractAddress, assetContract, tokenId, owner) {\n  try {\n    const ERC165Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC165.json')).default;\n    const erc165 = new Contract(assetContract, ERC165Abi, provider);\n    const [isERC721, isERC1155] = await Promise.all([erc165.supportsInterface(InterfaceId_IERC721), erc165.supportsInterface(InterfaceId_IERC1155)]);\n    if (isERC721) {\n      const ERC721Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC721.json')).default;\n      const asset = new Contract(assetContract, ERC721Abi, provider);\n      const approved = await asset.isApprovedForAll(owner, transferrerContractAddress);\n      if (approved) {\n        return true;\n      }\n\n      // Handle reverts in case of non-existent tokens\n      let approvedAddress;\n      try {\n        approvedAddress = await asset.getApproved(tokenId);\n      } catch (e) {}\n      return approvedAddress?.toLowerCase() === transferrerContractAddress.toLowerCase();\n    } else if (isERC1155) {\n      const ERC1155Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC1155.json')).default;\n      const asset = new Contract(assetContract, ERC1155Abi, provider);\n      return await asset.isApprovedForAll(owner, transferrerContractAddress);\n    } else {\n      console.error(\"Contract does not implement ERC 1155 or ERC 721.\");\n      return false;\n    }\n  } catch (err) {\n    console.error(\"Failed to check if token is approved\", err);\n    return false;\n  }\n}\n\n/**\n * Checks if the marketplace is approved to make transfers on the assetContract\n * If not, it tries to set the approval.\n * @param contractWrapper - The contract wrapper to use\n * @param marketplaceAddress - The address of the marketplace contract\n * @param assetContract - The address of the asset contract.\n * @param tokenId - The token id of the token.\n * @param from - The address of the account that owns the token.\n */\nasync function handleTokenApproval(contractWrapper, marketplaceAddress, assetContract, tokenId, from) {\n  const ERC165Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC165.json')).default;\n  const erc165 = new ContractWrapper(contractWrapper.getSignerOrProvider(), assetContract, ERC165Abi, contractWrapper.options, contractWrapper.storage);\n  const [isERC721, isERC1155] = await Promise.all([erc165.read(\"supportsInterface\", [InterfaceId_IERC721]), erc165.read(\"supportsInterface\", [InterfaceId_IERC1155])]);\n  // check for token approval\n  if (isERC721) {\n    const ERC721Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC721.json')).default;\n    const asset = new ContractWrapper(contractWrapper.getSignerOrProvider(), assetContract, ERC721Abi, contractWrapper.options, contractWrapper.storage);\n    const approved = await asset.read(\"isApprovedForAll\", [from, marketplaceAddress]);\n    if (!approved) {\n      const isTokenApproved = (await asset.read(\"getApproved\", [tokenId])).toLowerCase() === marketplaceAddress.toLowerCase();\n      if (!isTokenApproved) {\n        await asset.sendTransaction(\"setApprovalForAll\", [marketplaceAddress, true]);\n      }\n    }\n  } else if (isERC1155) {\n    const ERC1155Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC1155.json')).default;\n    const asset = new ContractWrapper(contractWrapper.getSignerOrProvider(), assetContract, ERC1155Abi, contractWrapper.options, contractWrapper.storage);\n    const approved = await asset.read(\"isApprovedForAll\", [from, marketplaceAddress]);\n    if (!approved) {\n      await asset.sendTransaction(\"setApprovalForAll\", [marketplaceAddress, true]);\n    }\n  } else {\n    throw Error(\"Contract must implement ERC 1155 or ERC 721.\");\n  }\n}\n\n/**\n * Used to verify fields in new listing.\n * @internal\n */\n// TODO this should be done in zod\nfunction validateNewListingParam(param) {\n  invariant(param.assetContractAddress !== undefined && param.assetContractAddress !== null, \"Asset contract address is required\");\n  invariant(param.buyoutPricePerToken !== undefined && param.buyoutPricePerToken !== null, \"Buyout price is required\");\n  invariant(param.listingDurationInSeconds !== undefined && param.listingDurationInSeconds !== null, \"Listing duration is required\");\n  invariant(param.startTimestamp !== undefined && param.startTimestamp !== null, \"Start time is required\");\n  invariant(param.tokenId !== undefined && param.tokenId !== null, \"Token ID is required\");\n  invariant(param.quantity !== undefined && param.quantity !== null, \"Quantity is required\");\n  switch (param.type) {\n    case \"NewAuctionListing\":\n      {\n        invariant(param.reservePricePerToken !== undefined && param.reservePricePerToken !== null, \"Reserve price is required\");\n      }\n  }\n}\n\n/**\n * Maps a contract offer to the strict interface\n *\n * @internal\n * @param offer - The offer to map\n * @returns  An `Offer` object\n */\nasync function mapOffer(provider, listingId, offer) {\n  return {\n    quantity: offer.quantityDesired,\n    pricePerToken: offer.pricePerToken,\n    currencyContractAddress: offer.currency,\n    buyerAddress: offer.offeror,\n    quantityDesired: offer.quantityWanted,\n    currencyValue: await fetchCurrencyValue(provider, offer.currency, offer.quantityWanted.mul(offer.pricePerToken)),\n    listingId\n  };\n}\nfunction isWinningBid(winningPrice, newBidPrice, bidBuffer) {\n  bidBuffer = BigNumber.from(bidBuffer);\n  winningPrice = BigNumber.from(winningPrice);\n  newBidPrice = BigNumber.from(newBidPrice);\n  if (winningPrice.eq(BigNumber.from(0))) {\n    return false;\n  }\n  const buffer = newBidPrice.sub(winningPrice).mul(MAX_BPS).div(winningPrice);\n  return buffer.gte(bidBuffer);\n}\nasync function getAllInBatches(start, end, fn) {\n  const batches = [];\n  while (end - start > DEFAULT_QUERY_ALL_COUNT) {\n    batches.push(fn(start, start + DEFAULT_QUERY_ALL_COUNT - 1));\n    start += DEFAULT_QUERY_ALL_COUNT;\n  }\n  batches.push(fn(start, end - 1));\n  return await Promise.all(batches);\n}\n\nexport { isWinningBid as a, getAllInBatches as g, handleTokenApproval as h, isTokenApprovedForTransfer as i, mapOffer as m, validateNewListingParam as v };\n","import { cx as BigNumberTransformSchema, cy as FileOrBufferOrStringSchema, cz as HexColor, cs as ContractWrapper } from './index-7c34e233.browser.esm.js';\nimport { z } from 'zod';\nimport { i as isNativeToken } from './fetchCurrencyValue-28e612f0.browser.esm.js';\n\nconst PropertiesInput = /* @__PURE__ */(() => z.object({}).catchall(z.union([BigNumberTransformSchema, z.unknown()])))();\n\n/**\n * @internal\n */\nconst OptionalPropertiesInput = /* @__PURE__ */(() => z.union([z.array(z.array(PropertiesInput)).transform(i => i.flat()), z.array(PropertiesInput), PropertiesInput]).optional().nullable())();\n\n/**\n * @internal\n */\nconst BasicNFTInput = /* @__PURE__ */(() => z.object({\n  name: z.union([z.string(), z.number()]).optional().nullable(),\n  description: z.string().nullable().optional().nullable(),\n  image: FileOrBufferOrStringSchema.nullable().optional(),\n  animation_url: FileOrBufferOrStringSchema.optional().nullable()\n}))();\n\n/**\n * @internal\n */\nconst CommonNFTInput = /* @__PURE__ */(() => BasicNFTInput.extend({\n  external_url: FileOrBufferOrStringSchema.nullable().optional(),\n  background_color: HexColor.optional().nullable(),\n  properties: OptionalPropertiesInput,\n  attributes: OptionalPropertiesInput\n}).catchall(z.union([BigNumberTransformSchema, z.unknown()])))();\n\n/**\n * @internal\n */\nconst NFTInputOrUriSchema = /* @__PURE__ */(() => z.union([CommonNFTInput, z.string()]))();\n\n/**\n * @internal\n */\nconst CommonNFTOutput = /* @__PURE__ */(() => CommonNFTInput.extend({\n  id: z.string(),\n  uri: z.string(),\n  image: z.string().nullable().optional(),\n  external_url: z.string().nullable().optional(),\n  animation_url: z.string().nullable().optional()\n}))();\n\n/**\n * @public\n */\n\n/**\n * @public\n */\n\n/**\n * @public\n */\n\n/**\n * @public\n */\n\n/**\n * @public\n */\n\n/**\n * @internal\n */\nasync function setErc20Allowance(contractToApprove, value, currencyAddress, overrides) {\n  if (isNativeToken(currencyAddress)) {\n    overrides[\"value\"] = value;\n  } else {\n    const ERC20Abi = (await import('@thirdweb-dev/contracts-js/dist/abis/IERC20.json')).default;\n    const signer = contractToApprove.getSigner();\n    const provider = contractToApprove.getProvider();\n    const erc20 = new ContractWrapper(signer || provider, currencyAddress, ERC20Abi, contractToApprove.options, contractToApprove.storage);\n    const owner = await contractToApprove.getSignerAddress();\n    const spender = contractToApprove.address;\n    const allowance = await erc20.read(\"allowance\", [owner, spender]);\n    if (allowance.lt(value)) {\n      // approve overrides the previous allowance, set it to the minimum required for this tx\n      await erc20.sendTransaction(\"approve\", [spender, value]);\n    }\n    return overrides;\n  }\n}\n\nexport { BasicNFTInput as B, CommonNFTInput as C, NFTInputOrUriSchema as N, CommonNFTOutput as a, setErc20Allowance as s };\n"],"names":["InterfaceId_IERC721","utils","InterfaceId_IERC1155","FALLBACK_METADATA","name","async","fetchTokenMetadata","tokenId","tokenUri","storage","startsWith","Buffer","base64","split","jsonMetadata","JSON","parse","from","toString","CommonNFTOutput","id","BigNumber","uri","parsedUri","replace","toHexString","slice","downloadJSON","err","unparsedTokenIdUri","e","console","warn","concat","stringify","fetchTokenMetadataForContract","contractAddress","provider","ERC165MetadataAbi","default","erc165","Contract","isERC721","isERC1155","Promise","all","supportsInterface","ERC721MetadataAbi","erc721","tokenURI","Error","ERC1155MetadataAbi","erc1155","uploadOrExtractURI","metadata","upload","CommonNFTInput","uploadOrExtractURIs","metadatas","startNumber","options","undefined","find","m","isUriList","isMetadataList","uploadBatch","map","rewriteFileNames","fileStartNumber","onProgress","getBaseUriFromBatch","uris","baseUri","substring","lastIndexOf","i","length","DEFAULT_QUERY_ALL_COUNT","cleanCurrencyAddress","currencyAddress","isNativeToken","NATIVE_TOKEN_ADDRESS","ContractInterceptor","constructor","contractWrapper","this","overrideNextTransaction","hook","withTransactionOverride","ContractPlatformFee","_defineProperty","FEATURE_PLATFORM_FEE","buildTransactionFunction","parsed","CommonPlatformFeeSchema","parseAsync","platformFeeInfo","Transaction","fromContractWrapper","method","args","platform_fee_recipient","platform_fee_basis_points","get","platformFeeRecipient","platformFeeBps","read","ContractRoles","roles","FEATURE_PERMISSIONS","rolesWithAddresses","actingAddress","connectedWalletAddress","getSignerAddress","contractEncoder","ContractEncoder","Object","keys","invariant","every","role","includes","currentRoles","getAll","encoded","sortedRoles","sort","_rolesWithAddresses$r","_currentRoles$role","addresses","currentAddresses","addressOrEns","resolveAddress","toAdd","filter","address","toRemove","index","indexOf","splice","push","forEach","encode","getRoleHash","getRevokeRoleFunctionName","revokeFunctionName","resolvedAddress","entries","_ref","item","wrapper","hasFunction","roleHash","count","toNumber","Array","verify","members","a","toLowerCase","MissingRoleError","signerAddress","ListingType","MarketplaceAuction","validateNewListingParam","listing","resolvedAssetAddress","assetContractAddress","resolvedCurrencyAddress","currencyContractAddress","handleTokenApproval","getAddress","normalizedPricePerToken","normalizePriceValue","getProvider","buyoutPricePerToken","normalizedReservePrice","reservePricePerToken","listingStartTime","Math","floor","startTimestamp","getTime","blockTime","getBlock","timestamp","assetContract","currencyToAccept","listingType","Auction","quantityToList","quantity","secondsUntilEndTime","listingDurationInSeconds","startTime","receipt","parseLogs","logs","listingId","data","listings","createListing","prepare","tx","event","validateListing","currencyMetadata","fetchCurrencyMetadata","makeBid","buyoutPrice","decimals","pricePerToken","normalizedPrice","eq","bidBuffer","winningBid","getWinningBid","isWinner","isWinningBid","tokenPrice","reservePrice","gte","value","mul","overrides","getCallOverrides","setErc20Allowance","constants","now","Date","startTimeInEpochSeconds","offers","gt","offeror","AuctionAlreadyStartedError","closeFor","message","AuctionHasNotEndedError","endTimeInEpochSeconds","closeForSeller","encoder","sellerAddress","closeForBuyer","buyerAddress","getListing","ListingNotFoundError","WrongListingTypeError","mapListing","mapOffer","getWinner","endTime","contractEvents","ContractEvents","auction","getEvents","winningBidder","getBidBufferBps","getMinimumNextBid","currentBidBufferBps","currentBidOrReservePrice","currencyValue","minimumNextBid","add","div","fetchCurrencyValue","error","currency","buyoutCurrencyValuePerToken","asset","reservePriceCurrencyValuePerToken","tokenOwner","type","MarketplaceDirect","Direct","quantityDesired","expirationDate","expirationTimestamp","addressOfOfferor","offer","receiver","valid","isStillValidListing","buyFor","startTimeInSeconds","secondsUntilEnd","getActiveOffer","isTokenApprovedForTransfer","ERC165Abi","_owner","ERC721Abi","owner","ownerOf","ERC1155Abi","balanceOf","Marketplace","chainId","_chainId","network","getAllListings","direct","buyoutListing","getChainID","makeOffer","NATIVE_TOKENS","wrapped","timeBuffer","getTimeBufferInSeconds","bufferBps","bufferInSeconds","addr","arguments","abi","ContractWrapper","AbiSchema","ContractMetadata","MarketplaceContractSchema","app","ContractAppURI","contractRoles","estimator","GasCostEstimator","events","platformFees","interceptor","onNetworkUpdated","updateSignerOrProvider","getActiveListings","rawListings","getAllListingsNoFilter","filtered","applyFilter","l","lte","getTotalCount","isRestrictedToListerRoleOnly","getOffers","listingEvents","order","filters","quantityWanted","totalOfferAmount","filterInvalidListings","start","seller","_filter$seller","tokenContract","_filter$tokenContract","_filter$tokenId","_","call","functionName","MARKETPLACE_CONTRACT_ROLES","transferrerContractAddress","_approvedAddress","isApprovedForAll","approvedAddress","getApproved","marketplaceAddress","getSignerOrProvider","sendTransaction","param","winningPrice","newBidPrice","sub","MAX_BPS","getAllInBatches","end","fn","batches","PropertiesInput","z","object","catchall","union","BigNumberTransformSchema","unknown","OptionalPropertiesInput","array","transform","flat","optional","nullable","BasicNFTInput","string","number","description","image","FileOrBufferOrStringSchema","animation_url","extend","external_url","background_color","HexColor","properties","attributes","NFTInputOrUriSchema","contractToApprove","ERC20Abi","signer","getSigner","erc20","spender","lt"],"sourceRoot":""}